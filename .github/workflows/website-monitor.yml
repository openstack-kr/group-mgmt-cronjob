name: Website Uptime Monitor to Discord

on:
  schedule:
    - cron: '0 */6 * * *' # 6시간마다 실행

jobs:
  check-websites-and-notify:
    runs-on: ubuntu-latest

    steps:
      - name: Check openstack-kr.org
        id: openstack-kr
        run: |
          status_code=$(curl -o /dev/null -s -w "%{http_code}\n" http://openstack-kr.org)
          echo "status=$status_code" >> $GITHUB_ENV
          if [ "$status_code" -ne 200 ]; then echo "::set-output name=openstack_kr_down::true"; fi

      - name: Check openinfra-kr.org
        id: openinfra-kr
        run: |
          status_code=$(curl -o /dev/null -s -w "%{http_code}\n" http://openinfra-kr.org)
          echo "status=$status_code" >> $GITHUB_ENV
          if [ "$status_code" -ne 200 ]; then echo "::set-output name=openinfra_kr_down::true"; fi

      - name: Send notification to Discord if any website is down
        if: steps.openstack-kr.outputs.openstack_kr_down == 'true' || steps.openinfra-kr.outputs.openinfra_kr_down == 'true'
        uses: Ilshidur/action-discord@master
        with:
          args: "One or more websites are down. Please check the logs for more details."
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
